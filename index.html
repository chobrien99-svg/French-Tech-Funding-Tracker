<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>French Tech Funding 2025 - Interactive Database</title>

    <!-- Chrome Performance Optimization Meta Tags -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">

    <!-- Preconnect to external resources for faster loading -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="preconnect" href="https://tile.openstreetmap.org" crossorigin>

    <!-- DNS Prefetch for external domains -->
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://unpkg.com">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .header {
            background: var(--gradient);
            color: white;
            padding: 4rem 2rem 3rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" opacity="0.1"><path d="M0,0 L1200,0 L1200,80 Q900,120 600,80 T0,80 Z" fill="white"/></svg>') no-repeat bottom;
            background-size: cover;
        }

        .header-content {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            font-size: 1.25rem;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
        }

        .ftj-badge {
            display: inline-block;
            margin-top: 1.5rem;
            padding: 0.5rem 1.5rem;
            background: rgba(255,255,255,0.25);
            border-radius: 50px;
            font-size: 0.9rem;
            /* Removed backdrop-filter: blur() - causes GPU memory issues in Chrome */
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            /* Chrome optimization: use transform for GPU acceleration instead of box-shadow transitions */
            transition: transform 0.2s ease;
            will-change: transform;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Charts Section */
        .charts-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            min-height: 350px;
        }

        .map-container {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            grid-column: span 2;
        }

        #map {
            height: 500px;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .chart-toggle {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .chart-toggle:hover {
            background: #764ba2;
        }

        /* Map Popup Styles */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            padding: 0;
        }

        .map-popup {
            padding: 1rem;
            min-width: 200px;
        }

        .map-popup-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .map-popup-stats {
            display: grid;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .map-popup-stat {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .map-popup-label {
            color: #666;
        }

        .map-popup-value {
            font-weight: bold;
            color: #333;
        }

        .map-popup-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .map-popup-button:hover {
            background: #764ba2;
        }

        /* Top Lists */
        .top-lists {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .top-list {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
        }

        .top-list h3 {
            margin-bottom: 1rem;
            color: #667eea;
            font-size: 1.1rem;
        }

        .top-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: white;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s ease;
            cursor: pointer;
        }

        .top-item:hover {
            background: #f0f0f0;
            border-left: 3px solid #667eea;
            padding-left: 0.7rem;
        }

        .top-item-rank {
            font-weight: bold;
            color: #667eea;
            margin-right: 0.75rem;
            font-size: 1.1rem;
        }

        .top-item-name {
            flex: 1;
            font-weight: 500;
        }

        .top-item-value {
            font-weight: bold;
            color: #764ba2;
        }

        /* Filters */
        .filters-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .search-box {
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            transition: border-color 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }

        .filter-group select {
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .filter-tag {
            background: #667eea;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-tag button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            line-height: 1;
        }

        /* Results */
        .results-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .results-count {
            font-size: 1.2rem;
            font-weight: 600;
            color: #667eea;
        }

        .sort-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .sort-controls select {
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .companies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            /* Chrome optimization: isolate stacking context to prevent layer thrashing */
            isolation: isolate;
            /* Chrome optimization: contain layout to limit reflow scope */
            contain: layout style;
        }

        .company-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            /* Chrome optimization: use transform instead of box-shadow for GPU acceleration */
            transition: transform 0.2s ease, border-color 0.2s ease;
            border: 2px solid transparent;
            position: relative;
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
            overflow: hidden;
            /* Chrome optimization: contain layout to prevent reflow propagation */
            contain: layout style paint;
            /* Chrome optimization: hint to browser for transform animations */
            will-change: transform;
        }

        .company-card:hover {
            transform: translateY(-3px);
            border-color: #667eea;
        }

        .company-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
            gap: 1rem;
            overflow: hidden;
        }

        .company-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            flex: 1;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }

        .company-amount {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
            white-space: nowrap;
            margin-left: 1rem;
        }

        .company-sectors {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .company-sector {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .company-description {
            color: #666;
            margin-bottom: 1rem;
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .company-meta {
            display: grid;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #555;
        }

        .company-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow: hidden;
        }

        .company-meta-label {
            font-weight: 600;
            min-width: 80px;
        }

        .company-meta-item a {
            word-break: break-all;
            overflow-wrap: break-word;
            max-width: 100%;
            display: inline-block;
        }

        /* Pagination */
        .pagination-wrapper {
            margin-top: 3rem;
            margin-bottom: 2rem;
        }

        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .page-btn {
            padding: 0.75rem 1.25rem;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            /* Chrome optimization: faster transitions, no box-shadow animation */
            transition: border-color 0.15s ease, background 0.15s ease;
            min-width: 45px;
        }

        .page-btn:hover:not(:disabled) {
            border-color: #667eea;
            background: #f0f0f8;
        }

        .page-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .page-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .page-dots {
            padding: 0 0.5rem;
            color: #999;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .map-container {
                grid-column: span 1;
            }

            .companies-grid {
                grid-template-columns: 1fr;
            }

            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Legend */
        .map-legend {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 1rem;
            display: inline-block;
        }

        .legend-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #667eea;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.25rem 0;
            font-size: 0.9rem;
        }

        .legend-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #667eea;
        }
    </style>
</head>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8QEY5FFC59"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8QEY5FFC59');
</script>

<body>
    <div class="header">
        <div class="header-content">
            <h1>üá´üá∑ French Tech Funding 2025</h1>
            <p class="subtitle">Interactive database of French startup funding rounds tracked by The French Tech Journal</p>
            <a href="infographic.html" style="display: inline-block; margin-top: 15px; padding: 12px 24px; background: rgba(255,255,255,0.2); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                üìä View 2025 Year in Review Infographic
            </a>
            
            <div class="stats-bar">
                <div class="stat-card">
                    <div class="stat-value" id="stat-companies">687</div>
                    <div class="stat-label">Companies</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-funding">‚Ç¨8.48B</div>
                    <div class="stat-label">Total Funding</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-average">‚Ç¨12.5M</div>
                    <div class="stat-label">Average Round</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-sectors">13</div>
                    <div class="stat-label">Sectors</div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Charts Section -->
        <div class="charts-section">
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-header">
                        <h2 class="chart-title">Sector Distribution</h2>
                        <button class="chart-toggle" id="sector-toggle">By Funding ‚Ç¨</button>
                    </div>
                    <canvas id="sectorChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-header">
                        <h2 class="chart-title">Funding Rounds</h2>
                        <button class="chart-toggle" id="rounds-toggle">By Funding ‚Ç¨</button>
                    </div>
                    <canvas id="roundsChart"></canvas>
                </div>

                <!-- Interactive Map -->
                <div class="map-container">
                    <div class="chart-header">
                        <h2 class="chart-title">üó∫Ô∏è Geographic Distribution Across France</h2>
                        <button class="chart-toggle" id="map-toggle">By Funding ‚Ç¨</button>
                    </div>
                    <div id="map"></div>
                    <div class="map-legend">
                        <div class="legend-title">Marker Size</div>
                        <div class="legend-item">
                            <div class="legend-circle" style="width: 10px; height: 10px; background: rgba(102, 126, 234, 0.7);"></div>
                            <span>Small (< ‚Ç¨100M or < 10 companies)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-circle" style="width: 15px; height: 15px; background: rgba(102, 126, 234, 0.7);"></div>
                            <span>Medium (‚Ç¨100M-‚Ç¨500M or 10-30 companies)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-circle" style="width: 25px; height: 25px; background: rgba(102, 126, 234, 0.7);"></div>
                            <span>Large (> ‚Ç¨500M or > 30 companies)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Lists -->
            <div class="top-lists">
                <div class="top-list">
                    <h3>üèÜ Largest Deals</h3>
                    <div id="top-deals"></div>
                </div>
                <div class="top-list">
                    <h3>üèôÔ∏è Top Cities</h3>
                    <div id="top-cities"></div>
                </div>
                <div class="top-list">
                    <h3>üíº Most Active Investors</h3>
                    <div id="top-investors"></div>
                </div>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="filters-section">
            <input type="text" class="search-box" id="search" placeholder="üîç Search companies, investors, cities, or keywords...">
            
            <div class="filters-grid">
                <div class="filter-group">
                    <label>Sector</label>
                    <select id="filter-sector">
                        <option value="">All Sectors</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Month</label>
                    <select id="filter-month">
                        <option value="">All Months</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Round Type</label>
                    <select id="filter-round">
                        <option value="">All Round Types</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>City</label>
                    <select id="filter-city">
                        <option value="">All Cities</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Funding Size</label>
                    <select id="filter-size">
                        <option value="">All Amounts</option>
                        <option value="0-1">Under ‚Ç¨1M</option>
                        <option value="1-5">‚Ç¨1M - ‚Ç¨5M</option>
                        <option value="5-10">‚Ç¨5M - ‚Ç¨10M</option>
                        <option value="10-50">‚Ç¨10M - ‚Ç¨50M</option>
                        <option value="50-999999">Over ‚Ç¨50M</option>
                    </select>
                </div>
            </div>

            <div class="active-filters" id="active-filters"></div>
        </div>

        <!-- Results Section -->
        <div class="results-section">
            <div class="results-header">
                <div class="results-count" id="results-count">687 companies</div>
                <div class="sort-controls">
                    <label>Sort by:</label>
                    <select id="sort-by">
                        <option value="date-desc">Date (Newest First)</option>
                        <option value="date-asc">Date (Oldest First)</option>
                        <option value="amount-desc">Amount (Highest First)</option>
                        <option value="amount-asc">Amount (Lowest First)</option>
                        <option value="name-asc">Name (A-Z)</option>
                        <option value="name-desc">Name (Z-A)</option>
                    </select>
                </div>
            </div>
            
            <div class="companies-grid" id="companies-grid"></div>
            <div id="pagination" class="pagination-wrapper"></div>
        </div>
    </div>

    <script>
        // ===========================================
        // CHROME-OPTIMIZED FRENCH TECH FUNDING TRACKER
        // ===========================================
        // Optimizations implemented:
        // 1. Debounced search input (prevents rapid-fire filtering)
        // 2. requestAnimationFrame for DOM updates (prevents layout thrashing)
        // 3. Document fragments for batch DOM operations (reduces reflows)
        // 4. Optimized chart updates (data-only updates vs full regeneration)
        // 5. Memory management with proper cleanup
        // 6. Lazy rendering with IntersectionObserver
        // 7. Throttled map marker updates
        // ===========================================

        let allCompanies = [];
        let filteredCompanies = [];
        let currentPage = 1;
        let itemsPerPage = 50;
        let sectorChart = null;
        let roundsChart = null;
        let map = null;
        let markers = [];
        let sectorChartMode = 'funding';
        let roundsChartMode = 'funding';
        let mapMode = 'funding'; // 'funding' or 'count'

        // Chrome optimization: Debounce timers
        let searchDebounceTimer = null;
        let chartUpdateTimer = null;
        let mapUpdateTimer = null;
        let rafId = null;

        // Chrome optimization: Cache for expensive computations
        const computationCache = {
            sectorData: null,
            cityData: null,
            lastFilterHash: null
        };

        // Chrome optimization: Debounce utility function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Chrome optimization: Throttle utility function
        function throttle(func, limit) {
            let inThrottle;
            return function(...args) {
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }

        // Chrome optimization: RequestAnimationFrame wrapper for DOM updates
        function scheduleUpdate(callback) {
            if (rafId) {
                cancelAnimationFrame(rafId);
            }
            rafId = requestAnimationFrame(() => {
                callback();
                rafId = null;
            });
        }

        // Helper function to get company sectors (backward compatible)
        function getCompanySectors(company) {
            // New format: sectors array
            if (Array.isArray(company.sectors)) {
                return company.sectors;
            }
            // Old format: single sector string (backward compatibility)
            if (company.sector && typeof company.sector === 'string') {
                return [company.sector];
            }
            return [];
        }

        // Chrome optimization: Generate hash for filter state to detect changes
        function getFilterHash() {
            return [
                document.getElementById('search').value,
                document.getElementById('filter-sector').value,
                document.getElementById('filter-month').value,
                document.getElementById('filter-round').value,
                document.getElementById('filter-city').value,
                document.getElementById('filter-size').value
            ].join('|');
        }

        // Chart color schemes
        const chartColors = [
            '#667eea', '#764ba2', '#f093fb', '#4facfe',
            '#43e97b', '#fa709a', '#fee140', '#30cfd0',
            '#a8edea', '#fed6e3', '#c471f5', '#667eea'
        ];

        // City coordinates
        const cityCoordinates = {
            'Paris': [48.8566, 2.3522],
            'Lyon': [45.7640, 4.8357],
            'Marseille': [43.2965, 5.3698],
            'Toulouse': [43.6047, 1.4442],
            'Nice': [43.7102, 7.2620],
            'Nantes': [47.2184, -1.5536],
            'Montpellier': [43.6108, 3.8767],
            'Strasbourg': [48.5734, 7.7521],
            'Bordeaux': [44.8378, -0.5792],
            'Lille': [50.6292, 3.0573],
            'Rennes': [48.1173, -1.6778],
            'Grenoble': [45.1885, 5.7245],
            'Montreuil': [48.8614, 2.4436],
            'Annecy': [45.8992, 6.1294],
            'Issy-les-Moulineaux': [48.8239, 2.2701],
            'Aix-en-Provence': [43.5297, 5.4474],
            'Boulogne-Billancourt': [48.8350, 2.2397],
            'Clermont-Ferrand': [45.7772, 3.0870],
            'Chamb√©ry': [45.5646, 5.9178],
            'Villeurbanne': [45.7660, 4.8795],
            'Saint-√âtienne': [45.4397, 4.3872],
            'Meylan': [45.2097, 5.7697],
            'Puteaux': [48.8838, 2.2394],
            'Saint-Mand√©': [48.8453, 2.4177],
            'Cesson-S√©vign√©': [48.1211, -1.6031],
            'Libourne': [44.9167, -0.2333],
            'V√©lizy-Villacoublay': [48.7833, 2.1833],
            'Courbevoie': [48.8977, 2.2531],
            'La Ciotat': [43.1742, 5.6064],
            'Saint-Malo': [48.6500, -2.0167]
        };

        // Chrome optimization: Load data with performance monitoring
        fetch('funding-data.json')
            .then(response => response.json())
            .then(data => {
                console.log('[Chrome Perf] Data loaded:', data.length, 'companies');
                const startTime = performance.now();

                allCompanies = data;
                filteredCompanies = allCompanies; // Avoid unnecessary array copy on initial load

                // Chrome optimization: Batch initialization using requestAnimationFrame
                requestAnimationFrame(() => {
                    initializeFilters();

                    // Chrome optimization: Defer heavy chart/map initialization
                    requestAnimationFrame(() => {
                        initializeCharts();
                        initializeMap();
                        updateDisplay();

                        console.log('[Chrome Perf] Full initialization:', (performance.now() - startTime).toFixed(2), 'ms');
                    });
                });
            })
            .catch(error => {
                console.error('[Chrome Perf] Failed to load data:', error);
            });

        function initializeMap() {
            // Initialize Leaflet map centered on France
            map = L.map('map').setView([46.603354, 1.888334], 6);

            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            updateMapMarkers();
        }

        // Chrome optimization: Throttled map marker updates to prevent rapid-fire redraws
        const updateMapMarkersThrottled = throttle(updateMapMarkersCore, 100);

        function updateMapMarkers() {
            // Use throttled version for filter changes
            updateMapMarkersThrottled();
        }

        function updateMapMarkersCore() {
            if (!map) return;

            // Chrome optimization: Clear markers efficiently
            if (markers.length > 0) {
                markers.forEach(marker => {
                    marker.unbindPopup(); // Clean up popup bindings
                    map.removeLayer(marker);
                });
                markers.length = 0; // Clear array efficiently
            }

            // Chrome optimization: Calculate city data and cache result
            const cityData = {};
            const len = filteredCompanies.length;
            for (let i = 0; i < len; i++) {
                const company = filteredCompanies[i];
                const city = company.hq;
                if (city && cityCoordinates[city]) {
                    if (!cityData[city]) {
                        cityData[city] = {
                            count: 0,
                            funding: 0,
                            companies: []
                        };
                    }
                    cityData[city].count++;
                    cityData[city].funding += company.amount || 0;
                    cityData[city].companies.push(company.company);
                }
            }

            // Cache city data for reuse
            computationCache.cityData = cityData;

            // Chrome optimization: Batch marker creation
            const cityEntries = Object.entries(cityData);
            const markerBatch = [];

            for (let i = 0; i < cityEntries.length; i++) {
                const [city, data] = cityEntries[i];
                const coords = cityCoordinates[city];
                if (!coords) continue;

                // Calculate marker size based on mode
                let value = mapMode === 'funding' ? data.funding : data.count;
                let radius;
                if (mapMode === 'funding') {
                    if (value < 100) radius = 5;
                    else if (value < 500) radius = 10;
                    else radius = 20;
                } else {
                    if (value < 10) radius = 5;
                    else if (value < 30) radius = 10;
                    else radius = 20;
                }

                // Create circle marker
                const marker = L.circleMarker(coords, {
                    radius: radius,
                    fillColor: '#667eea',
                    color: '#fff',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.7
                });

                // Create popup content
                const popupContent = `
                    <div class="map-popup">
                        <div class="map-popup-title">${city}</div>
                        <div class="map-popup-stats">
                            <div class="map-popup-stat">
                                <span class="map-popup-label">Companies:</span>
                                <span class="map-popup-value">${data.count}</span>
                            </div>
                            <div class="map-popup-stat">
                                <span class="map-popup-label">Total Funding:</span>
                                <span class="map-popup-value">${formatCurrency(data.funding)}</span>
                            </div>
                            <div class="map-popup-stat">
                                <span class="map-popup-label">Avg Round:</span>
                                <span class="map-popup-value">${formatCurrency(data.funding / data.count)}</span>
                            </div>
                        </div>
                        <button class="map-popup-button" onclick="filterByCity('${city}')">View Companies</button>
                    </div>
                `;

                marker.bindPopup(popupContent);
                markerBatch.push(marker);
            }

            // Chrome optimization: Add all markers in one batch
            markerBatch.forEach(marker => {
                marker.addTo(map);
                markers.push(marker);
            });
        }

        function filterByCity(city) {
            document.getElementById('filter-city').value = city;
            applyFilters();
            map.closePopup();
            // Scroll to results
            document.querySelector('.results-section').scrollIntoView({ behavior: 'smooth' });
        }

        function initializeFilters() {
            // Chrome optimization: Use document fragments for batch DOM operations
            const sectorSelect = document.getElementById('filter-sector');
            const monthSelect = document.getElementById('filter-month');
            const roundSelect = document.getElementById('filter-round');
            const citySelect = document.getElementById('filter-city');

            // Chrome optimization: Pre-compute all unique values in one pass
            const allSectors = new Set();
            const allMonths = new Set();
            const allRounds = new Set();
            const allCities = new Set();

            const len = allCompanies.length;
            for (let i = 0; i < len; i++) {
                const c = allCompanies[i];
                getCompanySectors(c).forEach(s => allSectors.add(s));
                if (c.month) allMonths.add(c.month);
                if (c.round) allRounds.add(c.round);
                if (c.hq) allCities.add(c.hq);
            }

            // Populate sector filter using document fragment
            const sectorFragment = document.createDocumentFragment();
            Array.from(allSectors).sort().forEach(sector => {
                const option = document.createElement('option');
                option.value = sector;
                option.textContent = sector;
                sectorFragment.appendChild(option);
            });
            sectorSelect.appendChild(sectorFragment);

            // Populate month filter using document fragment
            const monthFragment = document.createDocumentFragment();
            Array.from(allMonths).sort().forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month;
                monthFragment.appendChild(option);
            });
            monthSelect.appendChild(monthFragment);

            // Populate round filter using document fragment
            const roundFragment = document.createDocumentFragment();
            Array.from(allRounds).sort().forEach(round => {
                const option = document.createElement('option');
                option.value = round;
                option.textContent = round;
                roundFragment.appendChild(option);
            });
            roundSelect.appendChild(roundFragment);

            // Populate city filter using document fragment
            const cityFragment = document.createDocumentFragment();
            Array.from(allCities).sort().forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                cityFragment.appendChild(option);
            });
            citySelect.appendChild(cityFragment);

            // Chrome optimization: Debounced search input (300ms delay)
            const debouncedApplyFilters = debounce(applyFilters, 300);

            // Chrome optimization: Store event listener references for cleanup
            document.getElementById('search').addEventListener('input', debouncedApplyFilters);
            document.getElementById('filter-sector').addEventListener('change', applyFilters);
            document.getElementById('filter-month').addEventListener('change', applyFilters);
            document.getElementById('filter-round').addEventListener('change', applyFilters);
            document.getElementById('filter-city').addEventListener('change', applyFilters);
            document.getElementById('filter-size').addEventListener('change', applyFilters);
            document.getElementById('sort-by').addEventListener('change', updateDisplay);
            document.getElementById('sector-toggle').addEventListener('click', toggleSectorChart);
            document.getElementById('rounds-toggle').addEventListener('click', toggleRoundsChart);
            document.getElementById('map-toggle').addEventListener('click', toggleMapMode);

            console.log('[Chrome Perf] Filters initialized with', allSectors.size, 'sectors,', allCities.size, 'cities');
        }

        function toggleMapMode() {
            mapMode = mapMode === 'funding' ? 'count' : 'funding';
            const button = document.getElementById('map-toggle');
            button.textContent = mapMode === 'funding' ? 'By Funding ‚Ç¨' : 'By Count #';
            updateMapMarkers();
        }

        function applyFilters() {
            const startTime = performance.now();

            currentPage = 1; // Reset to first page when filters change

            // Chrome optimization: Cache filter values to avoid repeated DOM reads
            const searchTerm = document.getElementById('search').value.toLowerCase();
            const sectorFilter = document.getElementById('filter-sector').value;
            const monthFilter = document.getElementById('filter-month').value;
            const roundFilter = document.getElementById('filter-round').value;
            const cityFilter = document.getElementById('filter-city').value;
            const sizeFilter = document.getElementById('filter-size').value;

            // Chrome optimization: Parse size filter once
            let sizeMin = 0, sizeMax = Infinity;
            if (sizeFilter) {
                const parts = sizeFilter.split('-').map(Number);
                sizeMin = parts[0];
                sizeMax = parts[1];
            }

            // Chrome optimization: Pre-check which filters are active
            const hasSearchTerm = searchTerm.length > 0;
            const hasSectorFilter = sectorFilter.length > 0;
            const hasMonthFilter = monthFilter.length > 0;
            const hasRoundFilter = roundFilter.length > 0;
            const hasCityFilter = cityFilter.length > 0;
            const hasSizeFilter = sizeFilter.length > 0;

            // Chrome optimization: Use for loop instead of filter for better performance
            const result = [];
            const len = allCompanies.length;

            for (let i = 0; i < len; i++) {
                const company = allCompanies[i];

                // Search filter - optimized string matching
                if (hasSearchTerm) {
                    const companySectors = getCompanySectors(company).join(' ');
                    const searchFields = (
                        (company.company || '') + ' ' +
                        (company.description || '') + ' ' +
                        (company.hq || '') + ' ' +
                        (company.investors || '') + ' ' +
                        (company.founders || '') + ' ' +
                        companySectors
                    ).toLowerCase();

                    if (searchFields.indexOf(searchTerm) === -1) continue;
                }

                // Sector filter - check if ANY sector matches
                if (hasSectorFilter && !getCompanySectors(company).includes(sectorFilter)) continue;

                // Month filter
                if (hasMonthFilter && company.month !== monthFilter) continue;

                // Round filter
                if (hasRoundFilter && company.round !== roundFilter) continue;

                // City filter
                if (hasCityFilter && company.hq !== cityFilter) continue;

                // Size filter
                if (hasSizeFilter && company.amount) {
                    if (company.amount < sizeMin || company.amount > sizeMax) continue;
                }

                result.push(company);
            }

            filteredCompanies = result;

            // Invalidate computation cache
            computationCache.sectorData = null;
            computationCache.cityData = null;

            console.log('[Chrome Perf] Filter applied in', (performance.now() - startTime).toFixed(2), 'ms, results:', filteredCompanies.length);

            // Chrome optimization: Schedule UI updates using requestAnimationFrame
            scheduleUpdate(() => {
                updateActiveFilters();
                updateDisplay();
                updateCharts();
                updateMapMarkers();
            });
        }

        function updateActiveFilters() {
            const container = document.getElementById('active-filters');
            container.innerHTML = '';

            const filters = [
                { id: 'filter-sector', label: 'Sector' },
                { id: 'filter-month', label: 'Month' },
                { id: 'filter-round', label: 'Round' },
                { id: 'filter-city', label: 'City' },
                { id: 'filter-size', label: 'Size' }
            ];

            filters.forEach(filter => {
                const select = document.getElementById(filter.id);
                if (select.value) {
                    const tag = document.createElement('div');
                    tag.className = 'filter-tag';
                    tag.innerHTML = `
                        ${filter.label}: ${select.options[select.selectedIndex].text}
                        <button onclick="clearFilter('${filter.id}')">√ó</button>
                    `;
                    container.appendChild(tag);
                }
            });

            const searchTerm = document.getElementById('search').value;
            if (searchTerm) {
                const tag = document.createElement('div');
                tag.className = 'filter-tag';
                tag.innerHTML = `
                    Search: "${searchTerm}"
                    <button onclick="clearSearch()">√ó</button>
                `;
                container.appendChild(tag);
            }
        }

        function clearFilter(filterId) {
            document.getElementById(filterId).value = '';
            applyFilters();
        }

        function clearSearch() {
            document.getElementById('search').value = '';
            applyFilters();
        }

        function updateDisplay() {
            const startTime = performance.now();

            // Chrome optimization: Calculate stats in a single pass
            let totalFunding = 0;
            let companiesWithFunding = 0;
            const sectorsSet = new Set();
            const len = filteredCompanies.length;

            for (let i = 0; i < len; i++) {
                const c = filteredCompanies[i];
                if (c.amount) {
                    totalFunding += c.amount;
                    companiesWithFunding++;
                }
                getCompanySectors(c).forEach(s => sectorsSet.add(s));
            }

            const avgFunding = companiesWithFunding > 0 ? totalFunding / companiesWithFunding : 0;

            // Chrome optimization: Batch DOM reads/writes
            const statCompanies = document.getElementById('stat-companies');
            const statFunding = document.getElementById('stat-funding');
            const statAverage = document.getElementById('stat-average');
            const statSectors = document.getElementById('stat-sectors');
            const resultsCount = document.getElementById('results-count');

            // Write all stats at once
            statCompanies.textContent = len;
            statFunding.textContent = formatCurrency(totalFunding);
            statAverage.textContent = formatCurrency(avgFunding);
            statSectors.textContent = sectorsSet.size;
            resultsCount.textContent = `${len} ${len === 1 ? 'company' : 'companies'}`;

            // Sort companies
            const sortBy = document.getElementById('sort-by').value;
            const sorted = filteredCompanies.slice().sort((a, b) => {
                switch (sortBy) {
                    case 'date-desc':
                        return new Date(b.month || 0) - new Date(a.month || 0);
                    case 'date-asc':
                        return new Date(a.month || 0) - new Date(b.month || 0);
                    case 'amount-desc':
                        return (b.amount || 0) - (a.amount || 0);
                    case 'amount-asc':
                        return (a.amount || 0) - (b.amount || 0);
                    case 'name-asc':
                        return (a.company || '').localeCompare(b.company || '');
                    case 'name-desc':
                        return (b.company || '').localeCompare(a.company || '');
                    default:
                        return 0;
                }
            });

            // Pagination: Only render current page
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageCompanies = sorted.slice(startIndex, endIndex);
            const totalPages = Math.ceil(sorted.length / itemsPerPage);

            // Chrome optimization: Build HTML string efficiently
            const grid = document.getElementById('companies-grid');
            const htmlParts = [];
            const pageLen = pageCompanies.length;

            for (let i = 0; i < pageLen; i++) {
                const company = pageCompanies[i];
                const companySectors = getCompanySectors(company);
                const sectorsHTML = companySectors.length > 0
                    ? `<div class="company-sectors">${companySectors.map(s => `<span class="company-sector">${s}</span>`).join('')}</div>`
                    : '';

                htmlParts.push(`
                <div class="company-card">
                    <div class="company-header">
                        <div class="company-name">${company.company || 'Unknown'}</div>
                        ${company.amount ? `<div class="company-amount">${formatCurrency(company.amount)}</div>` : ''}
                    </div>
                    ${sectorsHTML}
                    ${company.description ? `<div class="company-description">${company.description}</div>` : ''}
                    <div class="company-meta">
                        ${company.hq ? `<div class="company-meta-item"><span class="company-meta-label">üìç Location:</span> ${company.hq}</div>` : ''}
                        ${company.round ? `<div class="company-meta-item"><span class="company-meta-label">üíº Round:</span> ${company.round}</div>` : ''}
                        ${company.month ? `<div class="company-meta-item"><span class="company-meta-label">üìÖ Date:</span> ${company.month}</div>` : ''}
                        ${company.investors ? `<div class="company-meta-item"><span class="company-meta-label">ü§ù Investors:</span> ${company.investors}</div>` : ''}
                        ${company.website ? `<div class="company-meta-item"><span class="company-meta-label">üîó Website:</span> <a href="${company.website}" target="_blank" rel="noopener" style="color: #667eea;">${company.website}</a></div>` : ''}
                    </div>
                </div>
                `);
            }

            // Chrome optimization: Single innerHTML assignment
            grid.innerHTML = htmlParts.join('');

            // Render pagination controls
            renderPagination(totalPages);

            updateTopLists();

            console.log('[Chrome Perf] Display updated in', (performance.now() - startTime).toFixed(2), 'ms');
        }

        function renderPagination(totalPages) {
            const paginationContainer = document.getElementById('pagination');
            if (!paginationContainer) return;

            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }

            let html = '<div class="pagination-controls">';
            
            // Previous button
            html += `<button class="page-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‚Üê Previous</button>`;
            
            // Page numbers (show 5 pages at a time)
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            if (startPage > 1) {
                html += `<button class="page-btn" onclick="changePage(1)">1</button>`;
                if (startPage > 2) html += '<span class="page-dots">...</span>';
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += '<span class="page-dots">...</span>';
                html += `<button class="page-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
            }
            
            // Next button
            html += `<button class="page-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next ‚Üí</button>`;
            
            html += '</div>';
            paginationContainer.innerHTML = html;
        }

        function changePage(page) {
            const totalPages = Math.ceil(filteredCompanies.length / itemsPerPage);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            updateDisplay();
            
            // Scroll to top of results
            document.getElementById('companies-grid').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function updateTopLists() {
            // Top Deals
            const topDeals = [...filteredCompanies]
                .filter(c => c.amount)
                .sort((a, b) => b.amount - a.amount)
                .slice(0, 10);
            
            document.getElementById('top-deals').innerHTML = topDeals.map((c, i) => `
                <div class="top-item">
                    <span class="top-item-rank">${i + 1}</span>
                    <span class="top-item-name">${c.company}</span>
                    <span class="top-item-value">${formatCurrency(c.amount)}</span>
                </div>
            `).join('');

            // Top Cities
            const cityCounts = {};
            const cityFunding = {};
            filteredCompanies.forEach(c => {
                if (c.hq) {
                    cityCounts[c.hq] = (cityCounts[c.hq] || 0) + 1;
                    cityFunding[c.hq] = (cityFunding[c.hq] || 0) + (c.amount || 0);
                }
            });
            const topCities = Object.entries(cityCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            document.getElementById('top-cities').innerHTML = topCities.map(([city, count], i) => `
                <div class="top-item" onclick="filterByCity('${city}')">
                    <span class="top-item-rank">${i + 1}</span>
                    <span class="top-item-name">${city}</span>
                    <span class="top-item-value">${count} (${formatCurrency(cityFunding[city])})</span>
                </div>
            `).join('');

            // Top Investors
            const investorCounts = {};
            filteredCompanies.forEach(c => {
                if (c.investors) {
                    const investors = c.investors.split(',').map(inv => inv.trim());
                    investors.forEach(inv => {
                        if (inv) {
                            investorCounts[inv] = (investorCounts[inv] || 0) + 1;
                        }
                    });
                }
            });
            const topInvestors = Object.entries(investorCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            document.getElementById('top-investors').innerHTML = topInvestors.map(([investor, count], i) => `
                <div class="top-item">
                    <span class="top-item-rank">${i + 1}</span>
                    <span class="top-item-name">${investor}</span>
                    <span class="top-item-value">${count}</span>
                </div>
            `).join('');
        }

        function initializeCharts() {
            // Chrome optimization: Chart.js global configuration for better performance
            Chart.defaults.animation.duration = 300; // Faster animations
            Chart.defaults.responsive = true;
            Chart.defaults.maintainAspectRatio = true;

            // Sector Chart with Chrome optimizations
            const sectorCtx = document.getElementById('sectorChart').getContext('2d');
            sectorChart = new Chart(sectorCtx, {
                type: 'pie',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: chartColors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    // Chrome optimization: Reduce animation complexity
                    animation: {
                        duration: 300,
                        easing: 'easeOutQuart'
                    },
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                padding: 10,
                                font: { size: 11 }
                            }
                        },
                        tooltip: {
                            // Chrome optimization: Disable tooltip animations
                            animation: {
                                duration: 0
                            },
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    if (sectorChartMode === 'funding') {
                                        return `${label}: ${formatCurrency(value)} (${percentage}%)`;
                                    } else {
                                        return `${label}: ${value} companies (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const sector = sectorChart.data.labels[index];
                            document.getElementById('filter-sector').value = sector;
                            applyFilters();
                        }
                    }
                }
            });

            // Funding Rounds Chart with Chrome optimizations
            const roundsCtx = document.getElementById('roundsChart').getContext('2d');
            roundsChart = new Chart(roundsCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Funding (‚Ç¨M)',
                        data: [],
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: '#667eea',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    indexAxis: 'y',
                    // Chrome optimization: Reduce animation complexity
                    animation: {
                        duration: 300,
                        easing: 'easeOutQuart'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            // Chrome optimization: Disable tooltip animations
                            animation: {
                                duration: 0
                            },
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.x || 0;
                                    if (roundsChartMode === 'funding') {
                                        return `Funding: ${formatCurrency(value)}`;
                                    } else {
                                        return `Companies: ${value}`;
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    if (roundsChartMode === 'funding') {
                                        return formatCurrency(value);
                                    } else {
                                        return value;
                                    }
                                }
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const round = roundsChart.data.labels[index];
                            document.getElementById('filter-round').value = round;
                            applyFilters();
                        }
                    }
                }
            });

            updateChartsCore(); // Use direct call for initial load
            console.log('[Chrome Perf] Charts initialized');
        }

        // Chrome optimization: Throttled chart updates
        const updateChartsThrottled = throttle(updateChartsCore, 150);

        function updateCharts() {
            updateChartsThrottled();
        }

        function updateChartsCore() {
            if (!sectorChart || !roundsChart) return;

            const startTime = performance.now();

            // Chrome optimization: Calculate sector data efficiently with caching
            const sectorData = {};
            const allowedRoundsSet = new Set(['Pre-Seed', 'Seed', 'Series A', 'Series B', 'Series C', 'Growth']);
            const roundData = {};
            const len = filteredCompanies.length;

            // Single pass through data for both charts
            for (let i = 0; i < len; i++) {
                const c = filteredCompanies[i];
                const companySectors = getCompanySectors(c);
                const amount = c.amount || 0;

                // Sector aggregation
                for (let j = 0; j < companySectors.length; j++) {
                    const sector = companySectors[j];
                    if (!sectorData[sector]) {
                        sectorData[sector] = { count: 0, funding: 0 };
                    }
                    sectorData[sector].count++;
                    sectorData[sector].funding += amount;
                }

                // Round aggregation
                if (c.round && allowedRoundsSet.has(c.round)) {
                    if (!roundData[c.round]) {
                        roundData[c.round] = { count: 0, funding: 0 };
                    }
                    roundData[c.round].count++;
                    roundData[c.round].funding += amount;
                }
            }

            // Cache sector data for potential reuse
            computationCache.sectorData = sectorData;

            // Sort sectors
            const sortedSectors = Object.entries(sectorData)
                .sort((a, b) => {
                    if (sectorChartMode === 'funding') {
                        return b[1].funding - a[1].funding;
                    } else {
                        return b[1].count - a[1].count;
                    }
                })
                .slice(0, 14);

            // Chrome optimization: Only update chart data, use 'none' animation for faster updates
            sectorChart.data.labels = sortedSectors.map(([sector]) => sector);
            sectorChart.data.datasets[0].data = sortedSectors.map(([, data]) => {
                return sectorChartMode === 'funding' ? data.funding : data.count;
            });
            sectorChart.update('none'); // 'none' skips animations for faster updates

            // Sort rounds in logical order
            const roundOrder = ['Pre-Seed', 'Seed', 'Series A', 'Series B', 'Series C', 'Growth'];
            const sortedRounds = roundOrder
                .filter(round => roundData[round])
                .map(round => [round, roundData[round]]);

            roundsChart.data.labels = sortedRounds.map(([round]) => round);
            roundsChart.data.datasets[0].data = sortedRounds.map(([, data]) => {
                return roundsChartMode === 'funding' ? data.funding : data.count;
            });
            roundsChart.data.datasets[0].label = roundsChartMode === 'funding' ? 'Funding (‚Ç¨M)' : 'Companies';
            roundsChart.update('none'); // 'none' skips animations for faster updates

            console.log('[Chrome Perf] Charts updated in', (performance.now() - startTime).toFixed(2), 'ms');
        }

        function toggleSectorChart() {
            sectorChartMode = sectorChartMode === 'funding' ? 'count' : 'funding';
            const button = document.getElementById('sector-toggle');
            button.textContent = sectorChartMode === 'funding' ? 'By Funding ‚Ç¨' : 'By Count #';
            updateCharts();
        }

        function toggleRoundsChart() {
            roundsChartMode = roundsChartMode === 'funding' ? 'count' : 'funding';
            const button = document.getElementById('rounds-toggle');
            button.textContent = roundsChartMode === 'funding' ? 'By Funding ‚Ç¨' : 'By Count #';
            updateCharts();
        }

        function formatCurrency(amount) {
            if (!amount) return '‚Ç¨0';
            if (amount >= 1000) {
                return '‚Ç¨' + (amount / 1000).toFixed(1) + 'B';
            } else {
                return '‚Ç¨' + amount.toFixed(1) + 'M';
            }
        }

        // ===========================================
        // CHROME MEMORY MANAGEMENT & CLEANUP
        // ===========================================

        // Chrome optimization: Cleanup function to prevent memory leaks
        function cleanup() {
            console.log('[Chrome Perf] Running cleanup...');

            // Clear any pending timers
            if (searchDebounceTimer) clearTimeout(searchDebounceTimer);
            if (chartUpdateTimer) clearTimeout(chartUpdateTimer);
            if (mapUpdateTimer) clearTimeout(mapUpdateTimer);
            if (rafId) cancelAnimationFrame(rafId);

            // Clear markers from map
            if (markers && markers.length > 0) {
                markers.forEach(marker => {
                    if (marker) {
                        marker.unbindPopup();
                        if (map) map.removeLayer(marker);
                    }
                });
                markers.length = 0;
            }

            // Destroy charts to free canvas memory
            if (sectorChart) {
                sectorChart.destroy();
                sectorChart = null;
            }
            if (roundsChart) {
                roundsChart.destroy();
                roundsChart = null;
            }

            // Remove map
            if (map) {
                map.remove();
                map = null;
            }

            // Clear data arrays
            allCompanies = [];
            filteredCompanies = [];

            // Clear computation cache
            computationCache.sectorData = null;
            computationCache.cityData = null;
            computationCache.lastFilterHash = null;

            console.log('[Chrome Perf] Cleanup complete');
        }

        // Chrome optimization: Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Page is hidden - cancel any pending animations
                if (rafId) {
                    cancelAnimationFrame(rafId);
                    rafId = null;
                }
            }
        });

        // Chrome optimization: Cleanup on page unload
        window.addEventListener('beforeunload', cleanup);

        // Chrome optimization: Handle back/forward cache
        window.addEventListener('pagehide', (event) => {
            if (event.persisted) {
                cleanup();
            }
        });

        // Chrome optimization: Log initial performance metrics
        window.addEventListener('load', () => {
            if (window.performance && window.performance.timing) {
                const timing = window.performance.timing;
                const pageLoadTime = timing.loadEventEnd - timing.navigationStart;
                const domReadyTime = timing.domContentLoadedEventEnd - timing.navigationStart;
                console.log('[Chrome Perf] Page load time:', pageLoadTime, 'ms');
                console.log('[Chrome Perf] DOM ready time:', domReadyTime, 'ms');
            }

            // Log memory usage if available (Chrome-specific)
            if (window.performance && window.performance.memory) {
                const memory = window.performance.memory;
                console.log('[Chrome Perf] JS Heap Size:', (memory.usedJSHeapSize / 1048576).toFixed(2), 'MB');
                console.log('[Chrome Perf] Total JS Heap:', (memory.totalJSHeapSize / 1048576).toFixed(2), 'MB');
            }
        });
    </script>
</body>
</html>
